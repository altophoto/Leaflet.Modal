"use strict";L.Map.Modal=L.Handler.extend({includes:L.Mixin.Events,statics:{BASE_CLS:"leaflet-modal",HIDE:"modal.hide",SHOW:"modal.show"},options:{OVERLAY_CLS:"overlay",MODAL_CLS:"modal",MODAL_CONTENT_CLS:"modal-content",SHOW_CLS:"show",CLOSE_CLS:"close",closeTitle:"close",zIndex:1e4,transitionDuration:300,wrapperTemplate:['<div class="{OVERLAY_CLS}"></div>','<div class="{MODAL_CLS}"><div class="{MODAL_CONTENT_CLS}">','<span class="{CLOSE_CLS}" title="{closeTitle}">&times;</span>',"{_content}","</div></div>"].join(""),template:"{content}"},initialize:function(t,i){L.Handler.prototype.initialize.call(this,t),L.Util.setOptions(this,i),this._visible=!1;var e=this._container=L.DomUtil.create("div",L.Map.Modal.BASE_CLS,t._container);e.style.zIndex=this.options.zIndex,e.style.position="absolute",this._map._controlContainer.appendChild(e),L.DomEvent.disableClickPropagation(e).disableScrollPropagation(e),this.enable()},addHooks:function(){L.DomEvent.on(document,"keydown",this._onKeyDown,this),this._map.on({modal:this._show},this)},removeHooks:function(){L.DomEvent.off(document,"keydown",this._onKeyDown,this),this._map.off({modal:this._show},this)},hide:function(){return this._hide(),this},isVisible:function(){return this._visible},_show:function(t){this._visible&&this._hide(),t=L.Util.extend({},this.options,t),this._render(t),this._setContainerSize(t);var i=this._getConentContainer(),e=this._map.getSize();i.offsetHeight<e.y&&(i.style.marginTop=(e.y-i.offsetHeight)/2+"px"),setTimeout(L.Util.bind(function(){L.DomUtil.addClass(this._container,this.options.SHOW_CLS)},this),0);var o=this._container.querySelector("."+this.options.CLOSE_CLS);o&&L.DomEvent.on(o,"click",this._hide,this);var n=this._container.querySelector("."+this.options.MODAL_CLS);n&&L.DomEvent.on(n,"mousedown",this._onMouseDown,this),this._visible=!0,"function"==typeof t.onShow&&this._map.once(L.Map.Modal.SHOW,t.onShow),"function"==typeof t.onHide&&this._map.once(L.Map.Modal.HIDE,t.onHide),this._map.fire(L.Map.Modal.SHOW,{modal:this})},_render:function(t){this._container.innerHTML=L.Util.template(t.wrapperTemplate,L.Util.extend({},t,{_content:L.Util.template(t.template,t)}))},_getConentContainer:function(){return this._container.querySelector("."+this.options.MODAL_CONTENT_CLS)},_setContainerSize:function(t){var i=this._getConentContainer();t.width&&(i.style.width=t.width+"px"),t.height&&(i.style.height=t.height+"px")},_hideInternal:function(){this._visible=!1,L.DomUtil.removeClass(this._container,this.options.SHOW_CLS)},_hide:function(){this._visible&&(this._hideInternal(),setTimeout(L.Util.bind(function(){this._map.fire(L.Map.Modal.HIDE,{modal:this})},this),this.options.transitionDuration))},_onMouseDown:function(t){var i=t.target||t.srcElement;L.DomUtil.hasClass(i,this.options.MODAL_CLS)&&this._hide()},_onKeyDown:function(t){var i=t.keyCode||t.which;27===i&&this._hide()}}),L.Map.addInitHook("addHandler","modal",L.Map.Modal),L.Map.include({openModal:function(t){return this.fire("modal",t)},closeModal:function(){return this.moadl.hide(),this}});